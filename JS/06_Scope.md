# Scope

###### 2020.04.07

## I. 스코프란?

- 특정 장소에 변수를 저장하고 나중에 그 변수를 찾기 위해 필요한 잘 정의된 규칙

## II. 컴파일러 이론

- 자바스크립트는 **컴파일러 언어**
- 자바스크립트 엔진은 전통적인 컴파일러 언어에서 컴파일러가 하는 일의 상당 부분을 우리가 아는 것보다 세련된 방식으로 처리한다.

### 자바스크립트의 컴파일레이션

1. 토크나이징 / 렉싱
   - 문자열을 나누어 **토큰**이라 불리는 의미있는 조각으로 만드는 과정
   - 토크나이저가 상태유지파싱 규칙을 적용해 어떠한 변수가 별개의 토큰인지 다른 토큰의 일부인지를 파악한다면 렉싱 아니면 토크나이징이다.
2. 파싱
   - 토큰 배열을 프로그램의 문법 구조를 반영하여 중첩 원소를 갖는 트리 형태로 바꾸는 과정이다.
   - **AST** : 파싱의 결과로 만들어진 트리
3. 코드 생성
   - AST를 컴퓨터에서 실행 코드로 바꾸는 과정
   - 언어에 따라, 목표하는 플랫폼에 따라 크게 달라진다.

### 자바스크립트 엔진

- 자바스크립트 엔진은 이 세가지 단계 뿐만 아니라 많은 부분에서 다른 프로그래밍 언어의 컴파일러보다 훨씬 복잡하다.
- i.e. 파싱과 코드 생성 과정에서 불필요한 요소를 삭제하는 과정을 거쳐 성능을 최적화한다.
- 자바스크립트 엔진은 가능한 가장 빠른 성능을 내기 휘해 트릭(여러 JIT들)을 사용한다.
- 즉, 어떤 자바스크립트 조각이라도 실행되려면 먼저 컴파일되어야 한다.

## III. 스코프 이해하기
- 엔진 : 컴파일레이션의 시작부터 끝까지 전 과정과 자바스크립트 프로그램 실행을 책임진다.
- 컴파일러 : 엔진의 친구로, 파싱과 코드 생성의 모든 잡일을 도맡아 한다.
- 스코프 : 엔진의 또 다른 친구로, 선언된 모든 확인자 검색 목록을 작성하고 유지한다. 또한, 엄격한 규칙을 강제하여 현재 실행 코드에서 확인자의 적용 방식을 정한다.

### `var a = 2;`

- 엔진은 `var a = 2;`를 서로 다른 두 개의 구믄으로 본다.
1. 먼저 컴파일러는 렉싱을 통해 구믄을 토큰으로 쪼갠다.
2. 토큰을 파싱해 트리 구조로 만든다.
3. 코드 생성 과정에 들어가면 컴파일러는 아래와 같이 프로그램을 처리한다.
   1. 컴파일러가 `var a`를 만나면 스코프에게 변수 a가 특정한 스코프 컬렉션 안에 있는지 묻는다.
   2. 변수 a가 이미 있다면 컴파일러는 선언을 무시하고 지나가고, 그렇지 않으면 컴파일러는 새로운 변수 a를 스코프 컬렉션 내에 선언하라고 요청한다.
   3. 구 후 컴파일러는 `a = 2` 대입문을 처리하기 위해 나중에 엔진이 실행할 수 있는 코드를 생성한다.
   4. 엔진이 실행하는 코드는 먼저 스코프에게 a라 부르는 변수가 헌재 스코프 컬렉션 내에서 접근할 수 있는지 확인한다.
   5. 가능하다면 엔진은 변수 a를 사용하고, 아니라면 엔진은 다른 곳을 살핀다.
4. 엔진이 마침내 변수를 찾으면 변수에 값 2를 넣고 못찾으면 에러를 발생시킨다.

#### 요약
1. 컴파일러가 변수를 선언한다.
2. 엔진이 스코프에서 변수를 찾고 변수가 있다면 변수를 대입한다.