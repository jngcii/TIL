# What is Docker?

###### 2020.07.09

- 도커는 리눅스 컨테이너에 여러 기능을 추가함으로써 애플리케이션을 컨테이너로서 좀 더 쉽게 사용할 수 있게 만들어진 오픈소스 프로젝트이다.
- Go 언어로 작성돼있다.
- 관련 프로젝트는 도커 컴포즈, 레지스트리, 도커 머신 등 여러가지가 있지만 **일반적으로 도커라 하면 도커 엔진이란 의미로 가장 많이 쓰인다.**
- 도커 엔진은 컨테이너를 생성하고 관리하는 주체로써 이 자체로도 컨테이너를 제어할 수 있고 다양한 기능을 제공한다.

## I. 가상 머신과 도커 컨테이너

### 1) 가상머신
- 하이퍼바이저를 이용해 여러 개의 운영체제를 하나의 호스트에서 생성해 사용하는 방식
- 이러한 여러 개의 운영체제를 가상 머신이라는 단위로 구별
- 하이퍼바이저에 의해 생성되고 관리되는 운영체제는 **게스트 운영체제**라고한다.
- 각 게스트 운영체제는 다른 게스트 운영체제와는 완전히 독립된 공간과 시스템 자원을 할당받음.
- 단점
  - 각종 시스템 자원을 가상화하고 독립된 공간을 생성하는 작업은 하이퍼바이저를 반드시 거쳐 성능의 손실이 발생
  - 가상 머신은 게스트 운영체제를 사용하기 위한 라이브러리, 커널 등을 전부 포함해 배포를 위해 이미지를 만들 때, 이미지의 크기가 커진다.
  - 즉, 일반 호스트에 비해 성능 손실이 있으며, 배포하기 부담스럽다.

### 2) 도커 컨테이너
- 가상화된 공간을 생성하기 위해 리눅스의 자체 기능인 chroot, namespace, cgroup을 사용함으로써 프로세스 단위의 격리 환경을 만들기 때문에 성능의 손실이 거의 없다.
- 컨테이너에 필요한 커널은 호스트 커널을 공유해 사용
- 컨테이너 안에는 애플리케이션을 구동하는 데 필요한 라이브러리 및 실행 파일만 존재
- 컨테이너를 이미지로 만들었을 때 이미지의 용량 또한 가상 머신에 비해 대폭 줄어든다.
- 배포 시간이 가상머신에 비해 빠르며, 가상화된 공간을 사용할 때의 성능 손실도 거의 없다.

## II. Why Docker?
  
### 1) 애플리케이션의 개발과 배포가 편해진다.
- 도커는 호스트OS 위에서 실행되는 격리된 공간으로, 컨테이너 자체에 특별한 권한을 주지 않는 한 컨테이너 내부에서 수많은 소프트웨어를 설치하고 설정 파일을 수정해도 호스트OS에는 영향을 끼치지 않는다.
- 컨테이너 내부에서 여러 작업을 마친 뒤 이를 운영 환경에 배포하려 할 때, 해당 컨테이너를 **도커 이미지**라 하는 일종의 패키지로 만들어 운영 서버에 전달하기만 하면 된다.
- 컨테이너에서 사용되던 운영서버에서 새롭게 패키지를 설치할 필요도 없으며, 각종 라이브러리 설치 등으로 인한 의존성을 걱정할 필요도 없다.
- 즉, 개발/운영 환경의 통합이 가능해진다.
- 도커 이미지는 가상 머신의 이미지와 달리 커널을 포함하고 있지 않기 때문에 이미지 크기가 크지 않다.

### 2) 여러 애플리케이션의 독립성과 확정성이 높아진다.
- 마이크로 서비스 구조는 여러 모듈을 독립된 형태로 구성하기 때문에 언어에 종속되지 않고 변화에 빠르게 대응할 수 있으며, 각 모듈의 관리가 쉬워진다.
- 예를 들어, 웹 서비스는 데이터베이스 컨테이너와 웹 서버 컨테이너로 분리할 수 있고 웹 서비스에 부하가 발생할 시 마이크로서비스 구조의 웹 서버 컨테이너만을 동적으로 늘려서 부하를 분산할 수 있다.
- 또한 버전을 독립적으로 관리하기 때문에 유지 보수도 용이해진다.
- 이와 같은 컨테이너 기반의 마이크로서비스는 개발자가 그 구조를 직접 구현하기보다는 도커 스웜모드, 쿠버네티스 등의 컨테이너 오케스트레이션 플랫폼을 통해 사용하는 것이 일반적이다.

## III. 도커 엔진 설치
- 도커는 리눅스 컨테이너를 제어하는 API를 Go언어로 구현한 libcontainer를 사용하기 때문에 대부분의 리눅스 운영체제에서 사용할 수 있다.

### 1) 도커 엔진의 종류 및 버전
- 도커 엔진은 도커 EE, 도커 CE로 구분
- (출시 년도).(출시 월)-(도커 엔진 종류) 형태의 버전이름
- 도커 EE는 유료로 제공되는 기업용 솔루션으로, 각종 기술 지원 및 실제 서비스 단계에서 필요한 각종 부가 기능을 도커 엔진과 함께 제공
- 도커 CE는 무료로 제공되는 도커 엔진으로서, 별도의 기술 지원 및 서비스르 제공하지는 않지만 도커 엔진 자체의 핵심적인 기능을 무료로 사용할 수 있다는 장점이 있다.
- 핵심적인 컨테이너 기술은 도커 CE에서도 동일하게 사용할 수 있다.
- 도커 CE는 stable(권장)과 edge 버전으로 구분해 각각 3개월, 1개월 단위로 릴리즈된다.

### 2) 리눅스 도커 엔진 설치
- 최신 버전 커널을 사용하고 있는지 확인 (호스트 운영체제가 최소한 3.10 버전 이상을 사용해야 도커 컨테이너를 정상적으로 사용할 수 있다.)
    ```shell
    # uname -r
    ```
- 지원 기간 내에 있는 배포판인지 확인
- 64비트 리눅스인지 확인
- root 권한으로 설치
- 각 리눅스 운영체제에서 도커를 설치하는 방법
    ```bash
    ### ubuntu 14.04, 16.04, 18.04
    $ sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -

    $ sudo add-apt-repository \
    "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"

    $ sudo apt-get update

    $ apt-get install docker-ce


    ### Centos 7, RHEL7
    $ sudo yum install -y yum-utils
    $ sudo yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo
    $ sudo yum install -y docker-ce
    $ systemctl start docker
    ```
- docker 정상 동작 확인
    ```bash
    $ docker info
    ```
    > 출시하고 어느정도 시간이 흐른 버전의 도커 엔진을 사용하는 것을 권장

### 3) 맥OS에 도커 설치
- 도커의 기능을 완전하게 사용하려면 리눅스에서 사용하는 것이 가장 바람직하지만 윈도우와 맥OSX에서도 간단한 테스트나 개발 용도로 사용할 수 있다.
- 원래는 윈도우와 맥 OSX에서 도커를 사용하려면 도커 툴박스라는 패키지를 설치해야 했다.
  - 도커 툴박스는 오라클 VirtualBox의 가상화기술을 이용해 리눅스 가상환경을 구축한 뒤 도커를 설치한다.
- 최근에는 윈도우와 OSX의 자체 가상화 기술을 사용한 도커가 출시되었다. (VirtualBox 의존 X)
  - Docker for windows에서는 Hyper-V 가상화 기술 이용해 리눅스 커널 기능과 도커 엔진 환경을 구성
  - Docker for Mac OSX는 xhyve 기술을 이용해 리눅스 커널 기능과 도커 엔진 환경을 구성

#### Docker for Mac 설치
- 도커 홈페이지의 Docker for Mac 페이지에서 Docker for Mac을 내려받아 설치


### 4) Docker Toolbox와 Docker for Windows/Mac의 차이점
- 툴박스로 설치된 도커와 자체 가상화 기술로 설치된 도커는 동일한 도커 엔진으로 동작한다.
- 툴박스
  - 리눅스 가상 머신을 생성해 그 내부에 도커를 설치
  - 가상 네트워크가 2개 생성됨 (로컬 -> 가상머신, 가상머신 -> 컨테이너)
  - 내부 IP를 가진 가상머신 안에 NAT IP를 할당받은 도커 컨테이너가 생성되므로 외부에서 접근하기 위해서는 2중 포트 포워딩이 필요하다.
  - 후자는 도커에서 컨테이너를 생성할 때 쉽게 설정할 수 있으나, 외부에서 컨테이너에 접근하기 위해서는 호스트와 가상 머신 사이의 포트 포워딩이 필요하다.
- Docker for Windows/Mac
  - 가상 머신을 생성하지 않고, 자체 가상화 기술로 리눅스 환경을 만들어 컨테이너를 생성
  - 포트포워딩을 설정하는 것만으로 외부에서 컨테이너에 접근할 수 있다.
  > 맥 도커에서 도커엔진이 사용하는 커널 버전을 보고 싶을 때
  > ```bash
  > $ docker info | grep kernel
  > ```